<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <title>Groeivergelijking Tool</title>

  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js v4 via CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>

  <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-50 text-gray-800 p-6">
  
  <!-- Back link -->
  <div class="mb-6">
    <a href="index.html" class="inline-block px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">← Terug naar hoofdtool</a>
  </div>

  <!-- Header -->
  <div class="mb-6 bg-white p-4 rounded-md shadow-sm">
    <h1 class="text-2xl font-bold mb-2">Groeivergelijking Tool</h1>
    <p class="text-gray-600">Vergelijk marktgroei, 4blue totaal groei en groei per merk in verschillende scenario's</p>
  </div>

  <!-- Scenario Management -->
  <div class="mb-6 bg-white p-4 rounded-md shadow-sm">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-semibold">Scenario's</h2>
      <button id="addScenarioBtn" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
        + Nieuw Scenario
      </button>
    </div>
    <div id="scenarioList" class="space-y-3">
      <!-- Scenario's worden hier dynamisch toegevoegd -->
    </div>
  </div>

  <!-- Chart -->
  <div class="mb-6 bg-white p-4 rounded-md shadow-sm">
    <h2 class="text-xl font-semibold mb-4">Groeivergelijking Grafiek</h2>
    <div class="mb-4 flex flex-wrap gap-4">
      <label class="flex items-center gap-2">
        <input type="number" id="monthsInput" min="6" max="60" value="12" class="px-3 py-2 border rounded-md w-24">
        <span>Aantal maanden</span>
      </label>
      <label class="flex items-center gap-2">
        <select id="periodUnitSelect" class="px-3 py-2 border rounded-md w-40">
          <option value="month">Per maand</option>
          <option value="quarter">Per kwartaal</option>
        </select>
        <span>Weergave</span>
      </label>
      <label class="flex items-center gap-2">
        <input type="number" id="yMaxInput" min="50" max="1000" step="50" value="100" class="px-3 py-2 border rounded-md w-28">
        <span>Y-as max (%)</span>
      </label>
    </div>
    <canvas id="growthChart" height="80"></canvas>
  </div>

  <!-- Template voor scenario (verborgen) -->
  <template id="scenarioTemplate">
    <div class="scenario-item border rounded-lg p-4 bg-gray-50">
      <div class="flex items-center justify-between mb-3">
        <div class="flex items-center gap-3">
          <input type="text" class="scenario-name px-3 py-2 border rounded-md flex-1" placeholder="Scenario naam" value="Scenario 1">
          <label class="flex items-center gap-2">
            <input type="checkbox" class="scenario-visible" checked>
            <span class="text-sm">Tonen</span>
          </label>
        </div>
        <button class="remove-scenario px-3 py-2 bg-red-600 text-white rounded hover:bg-red-700 text-sm">
          Verwijderen
        </button>
      </div>
      
      <div class="grid md:grid-cols-2 gap-4">
        <!-- Marktgroei -->
        <div class="bg-white p-3 rounded border">
          <label class="block text-sm font-medium mb-2">Marktgroei (%/maand)</label>
          <input type="number" class="market-growth px-3 py-2 border rounded-md w-full" min="0" max="100" step="0.1" value="2" placeholder="2.0">
        </div>

        <!-- 4blue Totaal -->
        <div class="bg-white p-3 rounded border">
          <label class="block text-sm font-medium mb-2">4blue Totaal Groei (%/maand)</label>
          <input type="number" class="blue4-total-growth px-3 py-2 border rounded-md w-full" min="0" max="100" step="0.1" value="5" placeholder="5.0">
        </div>
      </div>

      <!-- Merken -->
      <div class="mt-4">
        <div class="flex items-center justify-between mb-2">
          <label class="block text-sm font-medium">Merken</label>
          <button class="add-brand-btn px-3 py-1 bg-green-600 text-white rounded hover:bg-green-700 text-sm">
            + Merk toevoegen
          </button>
        </div>
        <div class="brands-container space-y-2">
          <!-- Merken worden hier dynamisch toegevoegd -->
        </div>
      </div>
    </div>
  </template>

  <!-- Template voor merk (verborgen) -->
  <template id="brandTemplate">
    <div class="brand-item bg-white p-3 rounded border flex items-center gap-3">
      <input type="text" class="brand-name px-2 py-1 border rounded flex-1 text-sm" placeholder="Merk naam" value="Merk 1">
      <label class="text-sm whitespace-nowrap">4blue groei:</label>
      <input type="number" class="brand-blue4-growth px-2 py-1 border rounded w-20 text-sm" min="0" max="100" step="0.1" value="6" placeholder="6.0">
      <label class="text-sm whitespace-nowrap">In markt:</label>
      <input type="number" class="brand-market-growth px-2 py-1 border rounded w-20 text-sm" min="0" max="100" step="0.1" value="3" placeholder="3.0">
      <button class="remove-brand px-2 py-1 bg-red-600 text-white rounded hover:bg-red-700 text-sm">
        ×
      </button>
    </div>
  </template>

  <script>
    let chart = null;
    let scenarios = [];
    let scenarioCounter = 1;

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      // Add first scenario
      addScenario();
      
      // Event listeners
      document.getElementById('addScenarioBtn').addEventListener('click', addScenario);
      document.getElementById('monthsInput').addEventListener('input', updateChart);
      document.getElementById('periodUnitSelect').addEventListener('change', updateChart);
      document.getElementById('yMaxInput').addEventListener('input', updateChart);
      
      // Load from localStorage
      loadFromStorage();
      
      // Initial chart render
      updateChart();
    });

    function addScenario() {
      const template = document.getElementById('scenarioTemplate');
      const clone = template.content.cloneNode(true);
      const scenarioDiv = clone.querySelector('.scenario-item');
      
      const scenario = {
        id: Date.now(),
        name: `Scenario ${scenarioCounter++}`,
        visible: true,
        marketGrowth: 2,
        blue4TotalGrowth: 5,
        brands: []
      };
      
      scenarios.push(scenario);
      
      // Set initial values
      const nameInput = clone.querySelector('.scenario-name');
      nameInput.value = scenario.name;
      nameInput.addEventListener('input', (e) => {
        scenario.name = e.target.value;
        updateChart();
      });
      
      const visibleCheckbox = clone.querySelector('.scenario-visible');
      visibleCheckbox.checked = scenario.visible;
      visibleCheckbox.addEventListener('change', (e) => {
        scenario.visible = e.target.checked;
        updateChart();
      });
      
      const marketGrowthInput = clone.querySelector('.market-growth');
      marketGrowthInput.value = scenario.marketGrowth;
      marketGrowthInput.addEventListener('input', (e) => {
        scenario.marketGrowth = parseFloat(e.target.value) || 0;
        updateChart();
      });
      
      const blue4TotalInput = clone.querySelector('.blue4-total-growth');
      blue4TotalInput.value = scenario.blue4TotalGrowth;
      blue4TotalInput.addEventListener('input', (e) => {
        scenario.blue4TotalGrowth = parseFloat(e.target.value) || 0;
        updateChart();
      });
      
      const removeBtn = clone.querySelector('.remove-scenario');
      removeBtn.addEventListener('click', () => {
        scenarios = scenarios.filter(s => s.id !== scenario.id);
        scenarioDiv.remove();
        updateChart();
        saveToStorage();
      });
      
      const addBrandBtn = clone.querySelector('.add-brand-btn');
      const brandsContainer = clone.querySelector('.brands-container');
      
      addBrandBtn.addEventListener('click', () => {
        addBrand(scenario, brandsContainer);
      });
      
      // Store reference to scenario div
      scenarioDiv.dataset.scenarioId = scenario.id;
      
      document.getElementById('scenarioList').appendChild(clone);
      saveToStorage();
    }

    function addBrand(scenario, container) {
      const template = document.getElementById('brandTemplate');
      const clone = template.content.cloneNode(true);
      const brandDiv = clone.querySelector('.brand-item');
      
      const brand = {
        id: Date.now(),
        name: `Merk ${scenario.brands.length + 1}`,
        blue4Growth: 6,
        marketGrowth: 3
      };
      
      scenario.brands.push(brand);
      
      const nameInput = clone.querySelector('.brand-name');
      nameInput.value = brand.name;
      nameInput.addEventListener('input', (e) => {
        brand.name = e.target.value;
        updateChart();
      });
      
      const blue4GrowthInput = clone.querySelector('.brand-blue4-growth');
      blue4GrowthInput.value = brand.blue4Growth;
      blue4GrowthInput.addEventListener('input', (e) => {
        brand.blue4Growth = parseFloat(e.target.value) || 0;
        updateChart();
      });
      
      const marketGrowthInput = clone.querySelector('.brand-market-growth');
      marketGrowthInput.value = brand.marketGrowth;
      marketGrowthInput.addEventListener('input', (e) => {
        brand.marketGrowth = parseFloat(e.target.value) || 0;
        updateChart();
      });
      
      const removeBtn = clone.querySelector('.remove-brand');
      removeBtn.addEventListener('click', () => {
        scenario.brands = scenario.brands.filter(b => b.id !== brand.id);
        brandDiv.remove();
        updateChart();
        saveToStorage();
      });
      
      container.appendChild(clone);
      saveToStorage();
    }

    function calculateGrowthPercent(growthRate, months) {
      const result = [];
      const factor = 1 + (growthRate / 100);
      for (let i = 1; i <= months; i++) {
        const percentage = (Math.pow(factor, i) - 1) * 100;
        result.push(percentage);
      }
      return result;
    }
    
    function transformDataForPeriod(data, periodUnit, months) {
      if (periodUnit === 'quarter') {
        const quarterCount = Math.ceil(months / 3);
        const quarterData = [];
        for (let q = 0; q < quarterCount; q++) {
          const lastMonthIndex = Math.min(data.length - 1, (q + 1) * 3 - 1);
          quarterData.push(data[lastMonthIndex]);
        }
        return quarterData;
      }
      return data;
    }

    function buildLabels(months, periodUnit) {
      if (periodUnit === 'quarter') {
        const quarterCount = Math.ceil(months / 3);
        return Array.from({ length: quarterCount }, (_, i) => `Q${i + 1}`);
      }
      return Array.from({ length: months }, (_, i) => `M${i + 1}`);
    }

    function updateChart() {
      const months = parseInt(document.getElementById('monthsInput').value) || 12;
      const periodUnit = document.getElementById('periodUnitSelect').value || 'month';
      const yMaxValue = parseFloat(document.getElementById('yMaxInput').value) || null;
      
      const labels = buildLabels(months, periodUnit);
      const datasets = [];
      const colors = [
        '#ef4444', // red - markt
        '#3b82f6', // blue - 4blue totaal
        '#10b981', // green
        '#f59e0b', // orange
        '#8b5cf6', // purple
        '#ec4899', // pink
        '#06b6d4', // cyan
        '#84cc16', // lime
      ];
      
      let colorIndex = 0;
      
      scenarios.forEach((scenario, scenarioIndex) => {
        if (!scenario.visible) return;
        
        // Marktgroei
        const marketMonthly = calculateGrowthPercent(scenario.marketGrowth, months);
        const marketData = transformDataForPeriod(marketMonthly, periodUnit, months);
        datasets.push({
          label: `${scenario.name} - Marktgroei (${scenario.marketGrowth}%/maand)`,
          data: marketData,
          borderColor: colors[colorIndex % colors.length],
          backgroundColor: 'transparent',
          borderWidth: 2,
          borderDash: [5, 5],
          pointRadius: 0,
          tension: 0.1
        });
        colorIndex++;
        
        // 4blue Totaal
        const blue4Monthly = calculateGrowthPercent(scenario.blue4TotalGrowth, months);
        const blue4TotalData = transformDataForPeriod(blue4Monthly, periodUnit, months);
        datasets.push({
          label: `${scenario.name} - 4blue Totaal (${scenario.blue4TotalGrowth}%/maand)`,
          data: blue4TotalData,
          borderColor: colors[colorIndex % colors.length],
          backgroundColor: 'transparent',
          borderWidth: 2,
          pointRadius: 0,
          tension: 0.1
        });
        colorIndex++;
        
        // Merken
        scenario.brands.forEach((brand) => {
          // 4blue groei per merk
          const brandBlueMonthly = calculateGrowthPercent(brand.blue4Growth, months);
          const brandBlue4Data = transformDataForPeriod(brandBlueMonthly, periodUnit, months);
          datasets.push({
            label: `${scenario.name} - ${brand.name} 4blue (${brand.blue4Growth}%/maand)`,
            data: brandBlue4Data,
            borderColor: colors[colorIndex % colors.length],
            backgroundColor: 'transparent',
            borderWidth: 1.5,
            borderDash: [3, 3],
            pointRadius: 0,
            tension: 0.1
          });
          colorIndex++;
          
          // Groei in markt per merk
          const brandMarketMonthly = calculateGrowthPercent(brand.marketGrowth, months);
          const brandMarketData = transformDataForPeriod(brandMarketMonthly, periodUnit, months);
          datasets.push({
            label: `${scenario.name} - ${brand.name} in markt (${brand.marketGrowth}%/maand)`,
            data: brandMarketData,
            borderColor: colors[colorIndex % colors.length],
            backgroundColor: 'transparent',
            borderWidth: 1.5,
            borderDash: [2, 4],
            pointRadius: 0,
            tension: 0.1
          });
          colorIndex++;
        });
      });
      
      const ctx = document.getElementById('growthChart').getContext('2d');
      
      const yAxisConfig = {
        title: {
          display: true,
          text: 'Groei (%)'
        },
        beginAtZero: true,
        suggestedMax: yMaxValue || undefined,
        max: yMaxValue || undefined
      };
      
      const xAxisTitle = periodUnit === 'quarter' ? 'Kwartaal' : 'Maand';
      
      if (chart) {
        chart.data.labels = labels;
        chart.data.datasets = datasets;
        chart.options.scales.x.title.text = xAxisTitle;
        chart.options.scales.y = {
          ...chart.options.scales.y,
          ...yAxisConfig
        };
        chart.update();
      } else {
        chart = new Chart(ctx, {
          type: 'line',
          data: {
            labels: labels,
            datasets: datasets
          },
          options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
              tooltip: {
                mode: 'index',
                intersect: false,
                callbacks: {
                  label: function(context) {
                    let label = context.dataset.label || '';
                    if (label) {
                      label += ': ';
                    }
                    if (context.parsed.y !== null) {
                      label += `${context.parsed.y.toFixed(2)}%`;
                    }
                    return label;
                  }
                }
              },
              legend: {
                position: 'bottom',
                labels: {
                  boxWidth: 12,
                  padding: 8,
                  font: {
                    size: 11
                  }
                }
              }
            },
            scales: {
              x: {
                title: {
                  display: true,
                  text: xAxisTitle
                }
              },
              y: yAxisConfig
            }
          }
        });
      }
      
      saveToStorage();
    }

    function saveToStorage() {
      const data = {
        scenarios: scenarios,
        months: parseInt(document.getElementById('monthsInput').value) || 12,
        periodUnit: document.getElementById('periodUnitSelect').value || 'month',
        yMax: parseFloat(document.getElementById('yMaxInput').value) || null,
        scenarioCounter: scenarioCounter
      };
      localStorage.setItem('growthComparisonData', JSON.stringify(data));
    }

    function loadFromStorage() {
      try {
        const saved = localStorage.getItem('growthComparisonData');
        if (saved) {
          const data = JSON.parse(saved);
          
          if (data.scenarios && data.scenarios.length > 0) {
            // Clear existing scenarios
            scenarios = [];
            document.getElementById('scenarioList').innerHTML = '';
            
            // Restore scenarios
            data.scenarios.forEach((savedScenario) => {
              const template = document.getElementById('scenarioTemplate');
              const clone = template.content.cloneNode(true);
              const scenarioDiv = clone.querySelector('.scenario-item');
              
              const scenario = {
                id: savedScenario.id || Date.now() + Math.random(),
                name: savedScenario.name || `Scenario ${scenarioCounter++}`,
                visible: savedScenario.visible !== undefined ? savedScenario.visible : true,
                marketGrowth: savedScenario.marketGrowth || 2,
                blue4TotalGrowth: savedScenario.blue4TotalGrowth || 5,
                brands: savedScenario.brands || []
              };
              
              scenarios.push(scenario);
              
              // Set values
              const nameInput = clone.querySelector('.scenario-name');
              nameInput.value = scenario.name;
              nameInput.addEventListener('input', (e) => {
                scenario.name = e.target.value;
                updateChart();
              });
              
              const visibleCheckbox = clone.querySelector('.scenario-visible');
              visibleCheckbox.checked = scenario.visible;
              visibleCheckbox.addEventListener('change', (e) => {
                scenario.visible = e.target.checked;
                updateChart();
              });
              
              const marketGrowthInput = clone.querySelector('.market-growth');
              marketGrowthInput.value = scenario.marketGrowth;
              marketGrowthInput.addEventListener('input', (e) => {
                scenario.marketGrowth = parseFloat(e.target.value) || 0;
                updateChart();
              });
              
              const blue4TotalInput = clone.querySelector('.blue4-total-growth');
              blue4TotalInput.value = scenario.blue4TotalGrowth;
              blue4TotalInput.addEventListener('input', (e) => {
                scenario.blue4TotalGrowth = parseFloat(e.target.value) || 0;
                updateChart();
              });
              
              const removeBtn = clone.querySelector('.remove-scenario');
              removeBtn.addEventListener('click', () => {
                scenarios = scenarios.filter(s => s.id !== scenario.id);
                scenarioDiv.remove();
                updateChart();
                saveToStorage();
              });
              
              const addBrandBtn = clone.querySelector('.add-brand-btn');
              const brandsContainer = clone.querySelector('.brands-container');
              
              addBrandBtn.addEventListener('click', () => {
                addBrand(scenario, brandsContainer);
              });
              
              // Restore brands
              scenario.brands.forEach((savedBrand) => {
                const brandTemplate = document.getElementById('brandTemplate');
                const brandClone = brandTemplate.content.cloneNode(true);
                const brandDiv = brandClone.querySelector('.brand-item');
                
                const brand = {
                  id: savedBrand.id || Date.now() + Math.random(),
                  name: savedBrand.name || `Merk ${scenario.brands.length + 1}`,
                  blue4Growth: savedBrand.blue4Growth || 6,
                  marketGrowth: savedBrand.marketGrowth || 3
                };
                
                const nameInput = brandClone.querySelector('.brand-name');
                nameInput.value = brand.name;
                nameInput.addEventListener('input', (e) => {
                  brand.name = e.target.value;
                  updateChart();
                });
                
                const blue4GrowthInput = brandClone.querySelector('.brand-blue4-growth');
                blue4GrowthInput.value = brand.blue4Growth;
                blue4GrowthInput.addEventListener('input', (e) => {
                  brand.blue4Growth = parseFloat(e.target.value) || 0;
                  updateChart();
                });
                
                const marketGrowthInput = brandClone.querySelector('.brand-market-growth');
                marketGrowthInput.value = brand.marketGrowth;
                marketGrowthInput.addEventListener('input', (e) => {
                  brand.marketGrowth = parseFloat(e.target.value) || 0;
                  updateChart();
                });
                
                const removeBtn = brandClone.querySelector('.remove-brand');
                removeBtn.addEventListener('click', () => {
                  scenario.brands = scenario.brands.filter(b => b.id !== brand.id);
                  brandDiv.remove();
                  updateChart();
                  saveToStorage();
                });
                
                brandsContainer.appendChild(brandClone);
              });
              
              scenarioDiv.dataset.scenarioId = scenario.id;
              document.getElementById('scenarioList').appendChild(clone);
            });
            
            if (data.months) {
              document.getElementById('monthsInput').value = data.months;
            }
            if (data.periodUnit) {
              document.getElementById('periodUnitSelect').value = data.periodUnit;
            }
            if (data.yMax !== undefined && data.yMax !== null) {
              document.getElementById('yMaxInput').value = data.yMax;
            }
            if (data.scenarioCounter) {
              scenarioCounter = data.scenarioCounter;
            }
          }
        }
      } catch (e) {
        console.error('Error loading from storage:', e);
      }
    }
  </script>
</body>
</html>


