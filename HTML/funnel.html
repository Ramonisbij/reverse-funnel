<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Reverse Funnel Calculator</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>

  <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-50 text-gray-800 p-6">
  <div class="mb-6 flex items-center gap-3">
    <a href="index.html" class="px-3 py-2 rounded border bg-white hover:bg-gray-50">Forecast</a>
    <a href="combinations.html" class="px-3 py-2 rounded border bg-white hover:bg-gray-50">Article Combinations</a>
    <a href="funnel.html" class="px-3 py-2 rounded border bg-blue-600 text-white">Funnel Calculator</a>
  </div>

  <div class="flex items-center justify-between mb-4">
    <h1 class="text-2xl font-bold">Reverse Funnel Calculator</h1>
    <div class="flex gap-2">
      <button id="saveConfigBtn" class="px-3 py-2 text-sm bg-orange-600 text-white rounded">üíæ Save</button>
      <button id="loadConfigBtn" class="px-3 py-2 text-sm bg-stone-600 text-white rounded">üìÇ Load</button>
      <input id="loadConfigInput" type="file" accept="application/json" class="hidden">
    </div>
  </div>

  <p class="text-gray-600 mb-6">
    Start with the number of new customers you want to acquire per month (e.g. 4) and work your way up: what do you need to achieve that? All calculations are per month.
  </p>

  <!-- Reverse Funnel Calculator -->
  <div class="space-y-6">
    
    <!-- Main Layout: Inputs Left, Funnel Right -->
    <div class="grid lg:grid-cols-12 gap-4">
      
      <!-- Left Column: Input Fields (aligned with funnel from bottom to top) -->
      <div class="lg:col-span-4 space-y-3">
        
        <!-- CARE - New Customers (Bottom of funnel) -->
        <div class="bg-white p-3 rounded-md shadow-sm card">
          <div class="mb-2 flex flex-col gap-1">
            <div class="flex items-start justify-between gap-2">
        <div>
                <h2 class="text-base font-bold text-green-700" id="startModeTitle">CARE - New Customers</h2>
                <p class="text-[10px] text-gray-600" id="startModeDescription">Start here: how many new customers per month?</p>
        </div>
              <div>
                <label class="text-[9px] uppercase tracking-wide text-gray-400 block">Start with</label>
                <select id="startMode" class="px-1.5 py-0.5 border rounded text-[10px]">
                  <option value="customers">New customers</option>
                  <option value="oneonone">1-on-1's</option>
                  <option value="leads">Leads</option>
                  <option value="reach">Reach</option>
                </select>
      </div>
      </div>
    </div>

          <div class="space-y-2">
        <div>
              <label class="block mb-1 text-xs font-medium" id="startValueLabel">New customers per month</label>
              <input type="number" id="startValueInput" min="0" step="1" 
                     class="w-full px-2 py-1.5 border rounded-md text-sm font-semibold" 
                     placeholder="e.g. 4" value="4">
              <p class="text-[10px] text-gray-500 mt-0.5" id="startValueDescription">The number of new customers you want to acquire per month</p>
            </div>
            <div id="churnInputWrapper" class="space-y-1">
              <label class="block text-xs font-medium">
                Churn rate (% per month) <span class="text-gray-400 font-normal text-[10px]">(optional)</span>
              </label>
              <input type="number" id="churnRate" min="0" max="100" step="0.1" 
                     class="w-full px-2 py-1.5 border rounded-md text-sm" 
                     placeholder="e.g. 5" value="0">
            </div>
            <div class="p-2 bg-green-50 rounded text-[10px]">
              <div class="flex justify-between">
                <span class="text-gray-600" id="startInfoLabel">Target:</span>
                <span class="font-bold text-green-700" id="targetNewCustomers">4</span>
              </div>
              <div id="churnInfo" class="hidden mt-1 space-y-0.5 text-gray-600">
                <div class="flex justify-between">
                  <span>To maintain:</span>
                  <span id="customersToReplace">0</span>
                </div>
                <div class="flex justify-between">
                  <span>Total needed:</span>
                  <span class="font-semibold" id="totalNewCustomersNeeded">0</span>
                </div>
              </div>
            </div>
            
            <!-- Activities for New Customers -->
            <div class="border-t pt-2 mt-2">
              <div class="flex items-center justify-between mb-1.5">
                <label class="text-xs font-medium text-gray-700">Activities</label>
                <button type="button" onclick="addActivity('customerActivities')" class="text-[10px] px-1.5 py-0.5 bg-gray-100 text-gray-700 rounded hover:bg-gray-200">
                  + Add
                </button>
              </div>
              <div id="activities-customerActivities" class="space-y-1.5">
                <!-- Activities will be rendered here -->
              </div>
            </div>
          </div>
        </div>

        <!-- DO - Conversion Rates -->
        <div class="bg-white p-3 rounded-md shadow-sm card">
          <div class="mb-2">
            <h2 class="text-base font-bold text-purple-700">DO - Conversion Rates</h2>
            <p class="text-[10px] text-gray-600">1-on-1 to order and order to customer</p>
          </div>
          
          <div class="space-y-2">
        <div>
              <label class="block mb-1 text-xs font-medium">
                First 1-on-1 ‚Üí First order (%)
              </label>
              <input type="number" id="convConversationToOrder" min="0" max="100" step="0.1" 
                     class="w-full px-2 py-1.5 border rounded-md text-sm" 
                     placeholder="e.g. 40" value="40">
              <div class="mt-0.5 text-[10px] text-gray-600">
                1-on-1's needed: <span class="font-semibold" id="conversationsNeeded">0</span>
              </div>
        </div>
            
            <!-- Activities for DO ‚Üí Orders -->
            <div class="border-t pt-2 mt-2">
              <div class="flex items-center justify-between mb-1.5">
                <label class="text-xs font-medium text-gray-700">Activities (1-on-1 ‚Üí Orders)</label>
                <button type="button" onclick="addActivity('doToOrders')" class="text-[10px] px-1.5 py-0.5 bg-gray-100 text-gray-700 rounded hover:bg-gray-200">
                  + Add
                </button>
      </div>
              <div id="activities-doToOrders" class="space-y-1.5">
                <!-- Activities will be rendered here -->
      </div>
    </div>

        <div>
              <label class="block mb-1 text-xs font-medium">
                First order ‚Üí Active customer (%)
              </label>
              <input type="number" id="convOrderToCustomer" min="0" max="100" step="0.1" 
                     class="w-full px-2 py-1.5 border rounded-md text-sm" 
                     placeholder="e.g. 80" value="80">
              <div class="mt-0.5 text-[10px] text-gray-600">
                Orders needed: <span class="font-semibold" id="ordersNeeded">0</span>
              </div>
            </div>
            
            <!-- Activities for CARE ‚Üí Customers -->
            <div class="border-t pt-2 mt-2">
              <div class="flex items-center justify-between mb-1.5">
                <label class="text-xs font-medium text-gray-700">Activities (Orders ‚Üí Customers)</label>
                <button type="button" onclick="addActivity('careToCustomers')" class="text-[10px] px-1.5 py-0.5 bg-gray-100 text-gray-700 rounded hover:bg-gray-200">
                  + Add
                </button>
        </div>
              <div id="activities-careToCustomers" class="space-y-1.5">
                <!-- Activities will be rendered here -->
      </div>
      </div>
    </div>
  </div>

        <!-- THINK - Conversion Rate -->
        <div class="bg-white p-3 rounded-md shadow-sm card">
          <div class="mb-2">
            <h2 class="text-base font-bold text-blue-700">THINK - Conversion Rate</h2>
            <p class="text-[10px] text-gray-600">Leads to first 1-on-1</p>
          </div>
          
          <div class="space-y-2">
            <div>
              <label class="block mb-1 text-xs font-medium">
                Leads ‚Üí First 1-on-1 (%)
              </label>
              <input type="number" id="convLeadsToConversation" min="0" max="100" step="0.1" 
                     class="w-full px-2 py-1.5 border rounded-md text-sm" 
                     placeholder="e.g. 30" value="30">
              <div class="mt-0.5 text-[10px] text-gray-600">
                Leads needed: <span class="font-semibold" id="leadsNeeded">0</span>
              </div>
            </div>
            
            <!-- Activities for THINK ‚Üí 1-on-1 -->
            <div class="border-t pt-2 mt-2">
              <div class="flex items-center justify-between mb-1.5">
                <label class="text-xs font-medium text-gray-700">Activities</label>
                <button type="button" onclick="addActivity('thinkToOneOnOne')" class="text-[10px] px-1.5 py-0.5 bg-gray-100 text-gray-700 rounded hover:bg-gray-200">
                  + Add
                </button>
              </div>
              <div id="activities-thinkToOneOnOne" class="space-y-1.5">
                <!-- Activities will be rendered here -->
    </div>
      </div>
    </div>
  </div>

        <!-- SEE - Conversion Rate (Top of funnel) -->
        <div class="bg-white p-3 rounded-md shadow-sm card">
          <div class="mb-2">
            <h2 class="text-base font-bold text-gray-700">SEE - Conversion Rate</h2>
            <p class="text-[10px] text-gray-600">Reach to leads</p>
          </div>
          
          <div class="space-y-2">
            <div>
              <label class="block mb-1 text-xs font-medium">
                Reach ‚Üí Leads (%)
      </label>
              <input type="number" id="convReachToLeads" min="0" max="100" step="0.1" 
                     class="w-full px-2 py-1.5 border rounded-md text-sm" 
                     placeholder="e.g. 2" value="2">
              <div class="mt-0.5 text-[10px] text-gray-600">
                Reach needed: <span class="font-semibold" id="reachNeeded">0</span>
              </div>
            </div>
            
            <!-- Activities for SEE ‚Üí Leads -->
            <div class="border-t pt-2 mt-2">
              <div class="flex items-center justify-between mb-1.5">
                <label class="text-xs font-medium text-gray-700">Activities</label>
                <button type="button" onclick="addActivity('seeToLeads')" class="text-[10px] px-1.5 py-0.5 bg-gray-100 text-gray-700 rounded hover:bg-gray-200">
                  + Add
                </button>
              </div>
              <div id="activities-seeToLeads" class="space-y-1.5">
                <!-- Activities will be rendered here -->
              </div>
            </div>
    </div>
  </div>

      </div>

      <!-- Right Column: Funnel Visualization -->
    <div class="lg:col-span-8 bg-white p-6 rounded-md shadow-sm card">
      <div class="flex items-center justify-between mb-4">
        <div>
          <h3 class="font-semibold text-xl">Primary Funnel</h3>
          <p class="text-xs text-gray-500">Core SEE ‚Üí THINK ‚Üí DO ‚Üí CARE flow for the selected start mode.</p>
        </div>
        <label class="flex items-center gap-2 text-xs text-gray-600">
          <input type="checkbox" id="showPrimaryFunnelToggle" class="rounded border-gray-300" checked>
          Show
        </label>
      </div>
      <div class="flex items-center gap-2 mb-3">
        <input type="checkbox" id="showConversionsToggle" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
        <label for="showConversionsToggle" class="text-sm text-gray-700">Show conversion rates on funnel</label>
      </div>
      <div id="primaryFunnelWrapper" class="min-h-[600px]">
        <canvas id="funnelChart"></canvas>
      </div>
    </div>

    </div>

    <!-- Nurture Funnel Section (moved to bottom) -->
    <div class="bg-white p-6 rounded-md shadow-sm card mt-6">
      <div class="flex items-start justify-between mb-4">
        <div>
          <h3 class="font-semibold text-xl">Nurture Re-entry ‚Üí THINK</h3>
          <p class="text-xs text-gray-500 max-w-2xl mt-1">Capture drop-offs, keep them engaged, and re-enter them in the THINK phase (leads) after a delay.</p>
        </div>
        <div class="flex items-center gap-4">
          <label class="flex items-center gap-2 text-sm text-gray-700">
            <input type="checkbox" id="nurtureEnabled" class="rounded border-gray-300">
            Enable Nurture
          </label>
          <label class="flex items-center gap-2 text-xs text-gray-600">
            <input type="checkbox" id="showNurtureFunnelToggle" class="rounded border-gray-300" checked>
            Show Visualization
          </label>
        </div>
      </div>
      
      <!-- Nurture Settings -->
      <div id="nurtureSettings" class="mb-4 hidden">
        <div class="border rounded-md p-4 bg-amber-50">
          <div class="grid sm:grid-cols-3 gap-4 text-sm">
            <label class="space-y-1">
              <span class="text-xs font-medium text-gray-700">Capture drop-offs (%)</span>
              <input type="number" id="nurtureCapture" min="0" max="100" step="0.1" class="w-full px-3 py-2 border rounded text-sm" placeholder="e.g. 25">
            </label>
            <label class="space-y-1">
              <span class="text-xs font-medium text-gray-700">Convert back to THINK (%)</span>
              <input type="number" id="nurtureConversion" min="0" max="100" step="0.1" class="w-full px-3 py-2 border rounded text-sm" placeholder="e.g. 30">
            </label>
            <label class="space-y-1">
              <span class="text-xs font-medium text-gray-700">Delay (months)</span>
              <input type="number" id="nurtureDelay" min="0" max="12" step="1" class="w-full px-3 py-2 border rounded text-sm" placeholder="e.g. 1">
            </label>
          </div>
          <p class="text-xs text-gray-500 mt-3">Everyone captured enters a nurture sequence (weekly cases & discount). Conversions rejoin the THINK stage after the delay.</p>
        </div>
      </div>
      
      <div class="flex items-center gap-3 text-xs text-gray-500 mb-4">
        <span class="inline-flex items-center gap-1"><span class="inline-block w-3 h-3 rounded-full bg-amber-400"></span>Captured drop-offs</span>
        <span class="inline-flex items-center gap-1"><span class="inline-block w-3 h-3 rounded-full bg-sky-300"></span>Returning leads (back to THINK)</span>
      </div>
      <div id="nurtureFunnelWrapper" class="min-h-[250px]">
        <canvas id="nurtureFunnelChart"></canvas>
      </div>
    </div>

    <!-- Summary at Bottom -->
    <div class="bg-white p-6 rounded-md shadow-sm card border-2 border-blue-500">
      <h2 class="text-xl font-bold mb-4">üìä Summary per Month</h2>
      <div class="grid md:grid-cols-2 gap-4">
        <div class="space-y-2">
          <h3 class="font-semibold text-sm text-gray-700">What you need per month:</h3>
          <div class="space-y-1 text-sm">
            <div class="flex justify-between">
              <span>Reach (SEE):</span>
              <span class="font-semibold" id="summaryReach">0</span>
            </div>
            <div class="flex justify-between">
              <span>Leads (THINK):</span>
              <span class="font-semibold" id="summaryLeads">0</span>
            </div>
            <div class="flex justify-between">
              <span>1-on-1's (DO):</span>
              <span class="font-semibold" id="summaryConversations">0</span>
            </div>
            <div class="flex justify-between">
              <span>Orders (DO):</span>
              <span class="font-semibold" id="summaryOrders">0</span>
            </div>
            <div class="flex justify-between border-t pt-1 mt-1">
              <span>New customers (CARE):</span>
              <span class="font-semibold text-green-600" id="summaryNewCustomers">0</span>
            </div>
          </div>
        </div>
        <div class="space-y-2">
          <h3 class="font-semibold text-sm text-gray-700">Status:</h3>
          <div class="space-y-1 text-sm">
            <div class="flex justify-between">
              <span id="summaryStatusLabel">New customers (result):</span>
              <span class="font-semibold text-green-600" id="summaryTargetCustomers">4</span>
            </div>
            <div id="summaryChurnRow" class="hidden">
              <div class="flex justify-between">
                <span>Churn (per month):</span>
                <span class="font-semibold text-red-600" id="summaryChurn">0</span>
              </div>
            </div>
            <div class="mt-2 pt-2 border-t">
              <p class="text-xs text-gray-500">
                All numbers are per month. Adjust the conversion rates to achieve your goal.
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Year Planner -->
    <div class="bg-white p-6 rounded-md shadow-sm card">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-bold">Year Planner</h2>
        <p class="text-xs text-gray-500">Visualize the funnel impact over the next 12 months, including nurture reactivations.</p>
    </div>
    <div class="overflow-x-auto">
        <table class="w-full text-xs" id="yearPlannerTable">
        <thead>
            <tr class="border-b text-gray-500">
              <th class="text-left py-2 px-3">Month</th>
              <th class="text-right py-2 px-3">Reach</th>
              <th class="text-right py-2 px-3">Leads</th>
              <th class="text-right py-2 px-3">1-on-1's</th>
              <th class="text-right py-2 px-3">Orders</th>
              <th class="text-right py-2 px-3">Customers</th>
              <th class="text-right py-2 px-3 text-emerald-600">From nurture</th>
          </tr>
        </thead>
          <tbody id="yearPlannerBody">
            <tr class="border-b">
              <td colspan="7" class="py-4 px-3 text-center text-gray-400">Toggle the nurture funnel or adjust conversions to see the yearly plan.</td>
            </tr>
        </tbody>
      </table>
    </div>
  </div>

  </div>

  <!-- Terug link -->
  <div class="mt-8">
    <a href="index.html" class="inline-block px-4 py-2 bg-white border rounded hover:bg-gray-50">‚Üê Back to Forecast</a>
  </div>


  <script src="js/funnel-reverse.js" type="module"></script>
</body>
</html>


